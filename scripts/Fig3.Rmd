---
title: "Modeling Results"
output: html_document
---
This code loads and plots the posterior estimates of the model parameters. For the estimation of model parameters using HDDM, see the iPython notebook: HDDM.ipynb

```{r set-up, warning=FALSE, message=FALSE, results="hide"}
# Clear workspace
rm(list = ls())

# Load helper functions
source('helper_functions.R')

# Import libraries
packages = c("tidyr","dplyr","ggplot2","lme4","lmerTest","Hmisc","car","lmtest","Rarity","cowplot")
ipak(packages)

# Redo long calculations
redo_calc = 0;
```

### Load Data
```{r load-data}
# Read data
AllData = read.csv("../data/AllData.csv")

# Convert to factors
AllData$Sub = as.factor(AllData$Sub)
AllData$Pred = as.factor(AllData$Pred)
AllData$Want2See = as.factor(AllData$Want2See)
AllData$Con_Rev = factor(AllData$Con, levels = c('Coop','Comp'))

# Load psychometric results (see Fig. 2 code)
load("long_calc/ConditionxBet.Rda")

# Extract random slope of the interaction
intSlope = unlist(coef(res)$Sub$`ConCoop:Pred1`)

# Create datafrom for each subject's bias, and order in descending order
SubBias = as.data.frame(intSlope)
SubBias$Sub = unique(AllData$Sub)
SubBias = SubBias[order(-SubBias$intSlope), ]
```

### Parameter Estimates
```{r}
# Read in posterior distribution of each parameter
allParms = read.csv("../data/HDDM/full_100000_ParmsTrace.csv",header = F) 
colnames(allParms) = c("v_-1_-50","v_1_-50",
                       "v_-1_-15","v_1_-15",
                       "v_-1_-10","v_1_-10",
                       "v_-1_-5","v_1_-5",
                       "v_-1_0","v_1_0",
                       "v_-1_5","v_1_5",
                       "v_-1_10","v_1_10",
                       "v_-1_15","v_1_15",
                       "v_-1_50","v_1_50",
                       "z_-1","z_1",
                       "a","t")

a_trace = select(allParms,contains("a"))
t_trace = select(allParms,contains("t"))
z_trace = select(allParms,contains("z"))
v_trace = select(allParms,contains("v"))

z_bias_trace = z_trace;

rm(allParms)
rm(a_trace)
rm(t_trace)
```

```{r}
# Get z_trace
z_trace = gather(z_trace,key = "parm", value = "value") %>% 
  separate("parm", sep = "_", into = c("parm","mot"))

# Get v_trace
v_trace = mutate(v_trace, 
                 `vbias_-1` = 0.025 * `v_-1_-50` + 
                              0.075 * `v_-1_-15` + 
                              0.125 * `v_-1_-10` + 
                              0.175 * `v_-1_-5` +
                              0.200 * `v_-1_0` +
                              0.175 * `v_-1_5` +
                              0.125 * `v_-1_10` +
                              0.075 * `v_-1_15` +
                              0.025 * `v_-1_50`,
                  `vbias_1` = 0.025 * `v_1_-50` + 
                              0.075 * `v_1_-15` + 
                              0.125 * `v_1_-10` + 
                              0.175 * `v_1_-5` +
                              0.200 * `v_1_0` +
                              0.175 * `v_1_5` +
                              0.125 * `v_1_10` +
                              0.075 * `v_1_15` +
                              0.025 * `v_1_50`) %>%
  select(contains("bias"))
                 
v_trace = gather(v_trace,key = "parm", value = "value") %>% 
  separate("parm", sep = "_", into = c("parm","mot"))             
```

```{r fig.width = 9, fig.height = 5}
# Plot z
plot.z_trace = ggplot(z_trace,aes(value, y = ..scaled.., fill = mot, color=mot)) +
  geom_density(alpha = 0.2, adjust = 5, size = 0) +
  geom_line(stat = "density", adjust = 5, size = 3) +
  scale_colour_manual(values=myPalette) +
  ggtitle("Starting Point") +
  theme(legend.position = "none",
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_blank(), 
        axis.line = element_line(colour = "black"),
        axis.text.x  = element_text(size=13,color="black"),
        axis.text.y  = element_blank(),
        axis.title.x = element_text(size=15),
        axis.title.y = element_text(size=15),
        strip.background = element_blank(),
        strip.text.x = element_text(face = "bold", size = 15),
        plot.title = element_text(hjust = 0.5,face = "bold", size = (15))) +
  xlab("z") + ylab("Probability") +
  coord_cartesian(ylim=c(0, 1.15))

# Plot z difference
z_diff = z_trace$value[z_trace$mot=="1"] - z_trace$value[z_trace$mot=="-1"]
z_95 = quantile(z_diff,0.05)
z_diff = as.data.frame(z_diff)
plot.z_diff = 
  ggplot(z_diff,aes(z_diff, y = ..scaled..)) +
  geom_density(alpha = 0.2, adjust = 5, size = 0) +
  geom_line(stat = "density", adjust = 5, size = 3) +
  geom_vline(xintercept = z_95, size = 1.5) +
  geom_vline(xintercept = 0, size = 1.5, linetype="dashed") + 
  scale_colour_manual(values=myPalette) +
  ggtitle("z bias") +
  theme(legend.position = "none",
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_blank(), 
        axis.line = element_line(colour = "black"),
        axis.text.x  = element_text(size=13,color="black"),
        axis.text.y  = element_blank(),
        axis.title.x = element_text(size=15),
        axis.title.y = element_text(size=15),
        strip.background = element_blank(),
        strip.text.x = element_text(face = "bold", size = 15),
        plot.title = element_text(hjust = 0.5,face = "bold", size = (15))) +
  xlab("z_bias") + ylab("Probability") +
  coord_cartesian(ylim=c(0, 1.1))

# Plot v
plot.v_trace = ggplot(v_trace,aes(value, y = ..scaled.., fill = mot, color=mot)) +
  geom_density(alpha = 0.2, adjust = 5, size = 0) +
  geom_line(stat = "density", adjust = 5, size = 3) +
  scale_colour_manual(values=myPalette) +
  ggtitle("Drift Rate") +
  theme(legend.position = "none",
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_blank(), 
        axis.line = element_line(colour = "black"),
        axis.text.x  = element_text(size=13,color="black"),
        axis.text.y  = element_blank(),
        axis.title.x = element_text(size=15),
        axis.title.y = element_text(size=15),
        strip.background = element_blank(),
        strip.text.x = element_text(face = "bold", size = 15),
        plot.title = element_text(hjust = 0.5,face = "bold", size = (15))) +
  xlab("v") + ylab("Probability") +
  coord_cartesian(ylim=c(0, 1.15))

# Plot v difference
v_diff = v_trace$value[v_trace$mot=="1"] - v_trace$value[v_trace$mot=="-1"]
v_95 = quantile(v_diff,0.05)
v_diff = as.data.frame(v_diff)

plot.v_diff = 
  ggplot(v_diff,aes(v_diff, y = ..scaled..)) +
  geom_density(alpha = 0.2, adjust = 5, size = 0) +
  geom_line(stat = "density", adjust = 5, size = 3) +
  geom_vline(xintercept = v_95, size = 1.5) +
  geom_vline(xintercept = 0, size = 1.5, linetype="dashed") + 
  scale_colour_manual(values=myPalette) +
  ggtitle("v bias") +
  theme(legend.position = "none",
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_blank(), 
        axis.line = element_line(colour = "black"),
        axis.text.x  = element_text(size=13,color="black"),
        axis.text.y  = element_blank(),
        axis.title.x = element_text(size=15),
        axis.title.y = element_text(size=15),
        strip.background = element_blank(),
        strip.text.x = element_text(face = "bold", size = 15),
        plot.title = element_text(hjust = 0.5,face = "bold", size = (15))) +
  xlab("z_bias") + ylab("Probability") +
  coord_cartesian(ylim=c(0, 1.1))
```

```{r fig.width = 6, fig.height = 5}
# Stats
z_bias = mean(z_trace$value[z_trace$mot=="1"] < z_trace$value[z_trace$mot=="-1"])
cat("P_z(S > F) = ", z_bias)

v_bias = mean(v_trace$value[v_trace$mot=="1"] < v_trace$value[v_trace$mot=="-1"])
cat("P_v(S > F) = ", v_bias)

# Plot everything
plot_grid(plot.z_trace, plot.z_diff, plot.v_trace, plot.v_diff, labels = c('B','C','D','E'), ncol = 2)
```

**Modeling Results.** **B.** Posterior distribution of z estimated by the z & v model. z was higher when participants were motivated to see more scene than when participants were motivated to see more face. **C.** Posterior distribution of the bias in starting point. Dashed line indicates 0 (no bias) while the solid line indicates the 5th percentile of the distribution. More than 95% of the distribution was greater than 0, indicating the bias was credibly above 0. **D.** Posterior distribution of v estimated by the z & v model. v was higher when participants were motivated to see more scene than when participants were motivated to see more face. **E.** Posterior distribution of the bias in starting point. More than 95% of the distribution was greater than 0, indicating the bias was credibly above 0.